/*
 * mppt.c
 *
 *  Created on: Mar 2, 2025
 *      Author: apple
 */

#include "mppt.h"

void mppt(uint8_t *dutyCycle, const float *power, float *prevPower) {
    const uint8_t deltaDuty = 10;  // Incremento/decremento del Duty Cycle

    if (*power > *prevPower) {
        if (*dutyCycle <= 255 - deltaDuty) {
            *dutyCycle += deltaDuty;
        } else {
            *dutyCycle = 255; // Límite máximo
        }
    } else {
        if (*dutyCycle >= deltaDuty) {
            *dutyCycle -= deltaDuty;
        } else {
            *dutyCycle = 0; // Límite mínimo
        }
    }

    *prevPower = *power; // Actualizar `prevPower` con el nuevo valor
}
